---
title: MySQLç´¢å¼•åŸç†åŠåº”ç”¨åœºæ™¯
description: MySQLç´¢å¼•æ€»ç»“
categories: 
  - MySQL
tags: 
  - MySQL
  - ç´¢å¼•
  - B+æ ‘
keywords: MySQL,ç´¢å¼•,B+æ ‘
date: 2022-08-02 18:56:07
permalink: /pages/0f7e8e/
author: 
  name: benym
  link: https://github.com/benym
---

## ä»€ä¹ˆæ˜¯ç´¢å¼•

åœ¨å·¥ä½œå½“ä¸­ï¼Œæ¶‰åŠåˆ°MySQLçš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ç»™æŸä¸ªè¡¨æŸä¸ªå­—æ®µåŠ ç´¢å¼•çš„è¯‰æ±‚ï¼ŒåŠ ä¸Šç´¢å¼•èƒ½å¤Ÿè®©æˆ‘ä»¬çš„sqlå¾—åˆ°æŸ¥è¯¢é€Ÿåº¦ä¸Šçš„æå‡ã€‚ä½†ç´¢å¼•çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Œä»–åˆæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œéœ€è¦å¼€å‘è€…å¯¹åŸºç¡€çŸ¥è¯†æœ‰ä¸€å®šçš„äº†è§£ã€‚

## ç´¢å¼•åˆ†ç±»

ç´¢å¼•é€šè¿‡ç‰¹å®šçš„ä¸€äº›æ•°æ®ç»“æ„ï¼Œå°†æ•°æ®ç»„ç»‡æœ‰åºï¼Œå°†éšæœºI/Oå˜ä¸ºé¡ºåºI/Oï¼Œæœ‰æ•ˆå‡å°‘æŸ¥è¯¢ä¸€æ¡æ•°æ®æ‰€éœ€è¦æ‰«æçš„æ•°æ®é‡ï¼ŒåŠ å¿«æŸ¥è¯¢çš„é€Ÿåº¦ã€‚

ä»ä½¿ç”¨è€…çš„è§’åº¦è€Œè¨€ï¼ŒMySQLç´¢å¼•ä¸»è¦ä¸ºä»¥ä¸‹å‡ ç§ã€‚

**ä¸»é”®ç´¢å¼•**

æ ¹æ®æ•°æ®è¡¨ä¸»é”®å»ºç«‹çš„ç´¢å¼•ï¼Œä¸å…è®¸é‡å¤å’Œç©ºå€¼ã€‚ä¸»é”®ç´¢å¼•åˆ—å…¨è¡¨å”¯ä¸€

```sql
alter table 'table_name' add primary key pk_index_name('col_name');
```

**å”¯ä¸€ç´¢å¼•**

ç”¨äºç¡®ä¿å»ºç«‹ç´¢å¼•åˆ—å†…çš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œå…è®¸ç©ºå€¼ã€‚æ¯”å¦‚åŒæ ·ä¸ºageå­—æ®µï¼Œä¸èƒ½å‡ºç°2ä¸ªageä¸º10çš„æ•°æ®

```sql
alter table 'table_name' add unique unique_index_name('col_name');
```

**æ™®é€šç´¢å¼•**

ç”¨äºè¡¨ä¸­çš„æ™®é€šåˆ—æ„å»ºçš„ç´¢å¼•ï¼Œæ²¡æœ‰ç‰¹æ®Šé™åˆ¶

```sql
alter table 'table_name' add index index_name('col_name');
```

**è”åˆç´¢å¼•**

é‡‡ç”¨å¤šä¸ªåˆ—ç»„åˆæ„å»ºçš„ç´¢å¼•ï¼Œç”¨äºç»„åˆæœç´¢

```sql
alter table 'table_name' add index index_name('col1_name','col2_name');
```

**å…¨æ–‡ç´¢å¼•**

ç”¨äºå¤§æ–‡æœ¬å¯¹è±¡çš„åˆ—æ„å»ºç´¢å¼•

```sql
alter table 'table_name' add fulltext index full_index_name('col_name');
```

**ç©ºé—´ç´¢å¼•**

ç”¨äºGISåœ°å›¾æ•°æ®çš„ç´¢å¼•ï¼ŒMySQLä¸­çš„ç©ºé—´æ•°æ®ç±»å‹æœ‰GEOMETRYã€POINTã€LINESTRINGã€POLYGON

```sql
alter table 'table_name' add spatial index spa_index_name('col_name');
```

## ç´¢å¼•æ•°æ®ç»“æ„

æ ¹æ®æ•°æ®ç»“æ„çš„ä¸åŒï¼ŒMySQLçš„ç´¢å¼•å¯åˆ†ä¸º`å“ˆå¸Œç´¢å¼•`ã€`BTreeç´¢å¼•`ã€`B+Treeç´¢å¼•`ã€‚

**å“ˆå¸Œç´¢å¼•**

å“ˆå¸Œç´¢å¼•é€šè¿‡hashè¡¨å®ç°ï¼Œé€šè¿‡å°†hashå‡½æ•°è®¡ç®—å‡ºçš„hashå€¼å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼Œæ¥å®Œæˆkey-valueçš„å¿«é€ŸæŸ¥è¯¢

![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-hash.png/zipstyle)

é€šå¸¸è€Œè¨€å½“å‘ç”Ÿhashç¢°æ’ä¹‹å(å³ä¸¤ä¸ªkeyåœ¨ç»è¿‡hashå‡½æ•°ä¹‹åå€¼ä¸ºåŒä¸€ä¸ª)ï¼Œé‡‡ç”¨é“¾åœ°å€æ³•è§£å†³å†²çªï¼Œå¦‚ä¸Šå›¾ä¸­å°åˆ˜åˆ°å°ç‹çš„è¿æ¥çº¿ï¼Œè·å–keyæ‰¾åˆ°ç´¢å¼•åœ°å€ä¹‹åï¼Œé¡ºåºéå†åœ°å€å†…çš„é“¾è¡¨ï¼Œè·å¾—æœ€ç»ˆç»“æœã€‚

å“ˆå¸Œç´¢å¼•çš„ç‰¹ç‚¹å’Œhashmapç±»ä¼¼ï¼Œé€‚åˆäºç²¾ç¡®æŸ¥æ‰¾ï¼Œä½†ä¸é€‚åˆèŒƒå›´æŸ¥æ‰¾ï¼Œhashç å¹¶ä¸å…·æœ‰è§„å¾‹æ€§ï¼Œæ‰€ä»¥å­˜å‚¨hashç´¢å¼•æ—¶é¡ºåºæ€§æ˜¯æ— æ³•ä¿éšœçš„ã€‚

**BTreeç´¢å¼•**

å…³äºå¹³è¡¡äºŒå‰æœç´¢æ ‘çš„æ¦‚å¿µå’Œæ„ä¹‰å¯ä»¥è¯¦è§æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ğŸ‘‰[äºŒå‰æœç´¢æ ‘åŠAVLæ ‘è¯¦è§£](https://cloud.benym.cn/benym-book/pages/2efaaf/)ã€‚

Bæ ‘å®é™…ä¸Šæ˜¯ä¸€æ£µå¤šå‰å¹³è¡¡æœç´¢æ ‘ã€‚å…¶å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹

::: note

æ ¹èŠ‚ç‚¹å·¦ä¾§æ•°å€¼å°äºæ ¹èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹å³ä¾§æ•°å€¼å¤§äºæ ¹èŠ‚ç‚¹

æ¯ä¸ªå¶å­èŠ‚ç‚¹é«˜åº¦ä¸€è‡´

æŒ‡é’ˆpå­˜å‚¨èŠ‚ç‚¹çš„åœ°å€ä¿¡æ¯

éå¶å­èŠ‚ç‚¹ä¸º[key,data]äºŒå…ƒç»„ï¼Œå…¶ä¸­keyè¡¨ç¤ºä½œä¸ºç´¢å¼•çš„é”®ï¼Œdataä¸ºkeyå€¼æ‰€åœ¨è¡Œçš„æ•°æ®

:::

Bæ ‘çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º

![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-btree.png/zipstyle)

åœ¨Bæ ‘çš„ç»“æ„å›¾ä¸­ï¼Œå¯ä»¥å‘ç°æ¯ä¸ªèŠ‚ç‚¹ä¸ä»…ä»…åŒ…å«æ•°æ®çš„Keyå€¼ï¼Œè¿˜æœ‰dataå€¼ã€‚

è€Œæ¯é¡µçš„å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœdataæ¯”è¾ƒå¤§ï¼Œä¼šå¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹çš„Keyå­˜å‚¨è¾ƒå°‘ã€‚

å½“æ•°æ®é‡æ‰©å¤§æ—¶ï¼ŒBæ ‘åªèƒ½å¾€ä¸‹è¿›è¡Œåˆ†è£‚ï¼Œå¯¼è‡´æ ‘æ·±çš„å¢é«˜ï¼Œå¢åŠ äº†ç£ç›˜I/Oçš„æ¬¡æ•°ï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚

**B+Treeç´¢å¼•**

ä¸ºäº†è§£å†³Bæ ‘çš„æ•ˆç‡é—®é¢˜ï¼ŒB+æ ‘åšäº†å¦‚ä¸‹æ”¹è¿›

::: note

éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ä¿¡æ¯ï¼Œä¸å†å­˜å‚¨æ•°æ®

æ‰€æœ‰å¶å­èŠ‚ç‚¹ä¹‹é—´éƒ½æœ‰ä¸€ä¸ªé“¾æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹

æ•°æ®éƒ½å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­

:::

B+æ ‘çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º

![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-b%2Btree.png/zipstyle)

ä¸ºäº†æ›´è¯¦ç»†çš„æè¿°B+æ ‘ï¼Œå›¾ä¸­çš„æŒ‡é’ˆå†™æ˜äº†å­˜å‚¨çš„ç£ç›˜å—åç§°ï¼Œæœ€åº•ä¸‹ä¸€å±‚å«æœ‰æ•°æ®çš„ç£ç›˜å—è¢«ç§°ä¸º**æ•°æ®é¡µ**ï¼Œæ•°æ®é¡µä¹‹é—´é€šè¿‡åŒå‘é“¾è¡¨è¿›è¡Œè¿æ¥ï¼Œéå¶å­èŠ‚ç‚¹çš„ç£ç›˜å—è¢«ç§°ä¸º**ç´¢å¼•é¡µ**

å°†ä¸Šå›¾ä¸­ç£ç›˜å—2ä¸ç£ç›˜å—5ã€6ã€7æ‹¿å‡ºæ¥è¿›è¡Œç»†åˆ†ï¼Œæˆ‘ä»¬å±•å¼€å„ç£ç›˜å—ï¼ŒæŸ¥çœ‹å•ä¸ªç£ç›˜å—å†…æ•°æ®çš„æ’åˆ—æ–¹å¼

![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-b%2Btree-data.png/zipstyle)

MySQLåœ¨å­˜å‚¨æ•°æ®æ—¶ä»¥æ•°æ®é¡µä¸ºæœ€å°å•ä½ï¼Œä¸”æ•°æ®åœ¨æ•°æ®é¡µä¸­çš„å­˜å‚¨æ˜¯**è¿ç»­**çš„ï¼Œæ•°æ®é¡µä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§ä¸»é”®æ’åº(å¦‚æ²¡æœ‰ä¸»é”®åˆ™ç”±MySQLè‡ªèº«ç»´æŠ¤çš„ROW_IDæ’åº)ï¼Œè€Œæ•°æ®é¡µä¸æ•°æ®é¡µä¹‹é—´åˆ™é‡‡ç”¨**åŒå‘é“¾è¡¨**å…³è”ï¼Œæ•°æ®ä¸æ•°æ®ä¹‹é—´é€šè¿‡**å•å‘é“¾è¡¨**å…³è”ã€‚

åœ¨æ¯ä¸ªæ•°æ®é¡µä¸­ï¼Œå¿…ç„¶å­˜åœ¨æœ€å°ä¸»é”®ï¼Œæ¯ä¸ªæ•°æ®é¡µçš„æœ€å°ä¸»é”®+ç£ç›˜å—åœ°å€ä¼šå½¢æˆä¸€ä¸ªä¸»é”®ç›®å½•ï¼Œå¤šä¸ªä¸»é”®ç›®å½•ä¼šå½¢æˆä¸€ä¸ªç´¢å¼•é¡µ(å¦‚ç£ç›˜å—2ç»“æ„æ‰€ç¤º)ã€‚

::: tip

ç´¢å¼•é¡µçš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³æ•°æ®é¡µè®°å½•è¿‡å¤šï¼Œå¯¼è‡´ä¸»é”®ç›®å½•ç‰¹åˆ«å¤§ï¼Œå½±å“äºŒåˆ†æŸ¥æ‰¾æ•ˆç‡çš„é—®é¢˜ã€‚

ä¸æ•°æ®é¡µç±»ä¼¼ï¼Œå¦‚æœä¸€å¼ æ•°æ®é¡µ/ç´¢å¼•é¡µå­˜å‚¨ç©ºé—´ä¸å¤Ÿï¼Œåˆ™ç»§ç»­åˆ†è£‚åˆ°ä¸‹ä¸€å¼ ï¼Œå³ç»“æ„å›¾ä¸­å±•ç¤ºçš„ç£ç›˜å—1ã€2ã€3ã€4å‡ä¸ºç´¢å¼•é¡µ

:::

**é‚£ä¹ˆç´¢å¼•é¡µå’Œæ•°æ®é¡µåˆ°åº•æ˜¯å¤šå¤§çš„å¤§å°å‘¢**ï¼Ÿ

å¼•ç”¨ä¸€ä¸‹ç½‘ç»œä¸­çš„è§£é‡Š

> è®¡ç®—æœºåœ¨å­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œæœ€å°å­˜å‚¨å•å…ƒæ˜¯æ‰‡åŒºï¼Œä¸€ä¸ªæ‰‡åŒºçš„å¤§å°æ˜¯ 512 å­—èŠ‚ï¼Œè€Œæ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ XFS/EXT4ï¼‰æœ€å°å•å…ƒæ˜¯å—ï¼Œä¸€ä¸ªå—çš„å¤§å°æ˜¯ 4KBã€‚InnoDB å¼•æ“å­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œæ˜¯ä»¥é¡µä¸ºå•ä½çš„ï¼Œæ¯ä¸ªæ•°æ®é¡µçš„å¤§å°é»˜è®¤æ˜¯ 16KBï¼Œå³å››ä¸ªå—ã€‚

åŸºäºè¯¥ç†è®ºï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´ç®—å‡ºB+æ ‘èƒ½å¤Ÿå­˜å‚¨çš„æ•°æ®ã€‚

å‡è®¾æ•°æ®åº“ä¸­ä¸€æ¡è®°å½•æ˜¯`1KB`ï¼Œé‚£ä¹ˆä¸€ä¸ªé¡µå°±å¯ä»¥å­˜`16`æ¡æ•°æ®ï¼ˆå¶å­ç»“ç‚¹ï¼‰ï¼›å¯¹äºéå¶å­ç»“ç‚¹å­˜å‚¨çš„åˆ™æ˜¯é”®å€¼+æŒ‡é’ˆï¼Œåœ¨InnoDBä¸­ï¼Œä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°æ˜¯`6`ä¸ªå­—èŠ‚ï¼Œå‡è®¾æˆ‘ä»¬çš„ä¸»é”®æ˜¯bigint ï¼Œé‚£ä¹ˆä¸»é”®å `8`ä¸ªå­—èŠ‚ï¼Œå¿½ç•¥ä¸€äº›å…¶ä»–çš„å¤´ä¿¡æ¯å¤§å°ï¼Œå¤§è‡´è®¡ç®—å¯ä»¥å¾—åˆ°ï¼š

::: center
`16*1024/(8+6)=1170`
:::

å³ä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¯ä»¥æŒ‡å‘1170ä¸ªé¡µï¼Œé‚£ä¹ˆä¸€ä¸ªä¸‰å±‚çš„B+æ ‘å¯ä»¥å­˜å‚¨çš„æ•°æ®é‡ä¸ºï¼š

::: center
`1170*1170*16=21902400`
:::

å¤§çº¦2100ä¸‡æ¡æ•°æ®ã€‚

åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼ŒB+æ ‘çš„é«˜åº¦ä¸€èˆ¬ä¸º2-4 å±‚ï¼Œè¿™å°±å¯ä»¥æ»¡è¶³åƒä¸‡çº§çš„æ•°æ®çš„å­˜å‚¨ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œä¸€æ¬¡é¡µçš„æŸ¥æ‰¾ä»£è¡¨ä¸€æ¬¡I/Oï¼Œé‚£æˆ‘ä»¬é€šè¿‡ä¸»é”®ç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™ï¼Œå…¶å®æœ€å¤šåªéœ€è¦2-4æ¬¡I/Oæ“ä½œå°±å¯ä»¥äº†ã€‚

## B+Treeçš„æŸ¥è¯¢è¿‡ç¨‹

è¿˜æ˜¯åŸºäºB+æ ‘çš„ç»“æ„å›¾

å‡è®¾æˆ‘ä»¬è¦æŸ¥è¯¢`key=16`çš„æ•°æ®ï¼Œé€šè¿‡æœ€é¡¶å±‚ç´¢å¼•é¡µçš„æ¡ä»¶ï¼Œæˆ‘ä»¬çŸ¥é“éœ€è¦ä»ç£ç›˜å—2çš„ç´¢å¼•é¡µè¿›è¡ŒæŸ¥è¯¢ã€‚

ä¾æ¬¡æ¯”è¾ƒç£ç›˜å—2ä¸­çš„`key`å€¼ï¼Œèƒ½å¤ŸçŸ¥é“`key>=12`çš„æ•°æ®å‡åœ¨`p6`æŒ‡é’ˆæŒ‡å‘çš„ç£ç›˜å—å†…ã€‚

äºæ˜¯æˆ‘ä»¬å¯ä»¥å®šä½åˆ°ç£ç›˜å—7å¯¹åº”çš„æ•°æ®é¡µï¼Œé€šè¿‡é¡ºåºéå†æ•°æ®é¡µå†…çš„å•å‘é“¾è¡¨ï¼Œæœ€ç»ˆæ‰¾åˆ°`key=16`å¯¹åº”çš„`data`æ•°æ®è¡Œã€‚

## èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•

ä½œä¸ºéå¸¸é«˜é¢‘çš„çŸ¥è¯†ç‚¹ï¼Œè¿™ä¸¤ç§ç´¢å¼•é€šå¸¸ä¼šæœ‰å¦‚ä¸‹è§£é‡Š

::: note

èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹åº”çš„æ•°æ®æœ¬èº«

éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹åº”çš„æ•°æ®çš„ä¸»é”®é”®å€¼

:::

åœ¨Innodbä¸­èšç°‡ç´¢å¼•ä¸€èˆ¬é»˜è®¤ä»¥ä¸»é”®å»ºç«‹ï¼Œä¹Ÿç§°ä¸º**ä¸»é”®ç´¢å¼•**

éèšç°‡ç´¢å¼•åˆ™ä»¥å…¶ä»–éä¸»é”®å­—æ®µå»ºç«‹ï¼Œä¹Ÿç§°ä¸º**è¾…åŠ©ç´¢å¼•**

ä»¥ä¸‹åˆ—æ•°æ®è¡¨ä¸ºä¾‹
::: center
![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-table.png/zipstyle)
:::

å¦‚æœé‡‡ç”¨èšç°‡ç´¢å¼•çš„å­˜å‚¨æ–¹å¼(ä¸»é”®ä¸ºID)ï¼Œåˆ™å¯¹åº”çš„ç´¢å¼•ç»“æ„ä¸º

![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-clus.png/zipstyle)

å¯ä»¥çœ‹å‡º**èšç°‡ç´¢å¼•çš„æ•°æ®å’Œç´¢å¼•å­˜å‚¨åœ¨ä¸€èµ·**ï¼Œæ ¹æ®Idç´¢å¼•èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„æ•°æ®è¡Œï¼Œæ¯”å¦‚`where Id = 7`è¿™æ ·çš„æ¡ä»¶ï¼Œèšç°‡ç´¢å¼•èƒ½å¤ŸæŸ¥åˆ°å¯¹åº”ä¸»é”®ï¼Œè·å¾—å¯¹åº”çš„å¶å­èŠ‚ç‚¹ä¸Šçš„è¡Œæ•°æ®ã€‚

å¦‚æœä»¥Nameå­—æ®µå»ºç«‹ç´¢å¼•ï¼Œåˆ™å¯¹åº”çš„è¾…åŠ©ç´¢å¼•ç»“æ„ä¸º

![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-noclus.png/zipstyle)

å¯ä»¥çœ‹å‡º**éèšç°‡ç´¢å¼•çš„æ•°æ®å’Œç´¢å¼•ï¼Œå¹¶éå­˜å‚¨åœ¨ä¸€èµ·**ï¼Œæ ¹æ®Nameç´¢å¼•åªèƒ½æ‰¾åˆ°Nameå¯¹åº”çš„ä¸»é”®Idï¼Œæ¯”å¦‚`where Name = å¼ ä¸‰`ï¼Œéèšç°‡ç´¢å¼•éœ€è¦é€šè¿‡**ä¸¤ä¸ªæ­¥éª¤**æ‰èƒ½è·å–è¡Œæ•°æ®ã€‚

- ç¬¬ä¸€æ­¥ï¼Œåœ¨éèšç°‡ç´¢å¼•çš„B+æ ‘ä¸­æŸ¥è¯¢å¯¹åº”Nameï¼Œè·å¾—å¶å­èŠ‚ç‚¹ä¸ŠåŒ¹é…çš„Nameçš„ä¸»é”®ã€‚

- ç¬¬äºŒæ­¥ï¼Œæ ¹æ®åŒ¹é…çš„ä¸»é”®Idåœ¨èšç°‡ç´¢å¼•B+æ ‘ä¸Šå†æ‰§è¡Œä¸€æ¬¡æ£€ç´¢ï¼Œè·å–å¶å­èŠ‚ç‚¹ä¸Šçš„è¡Œæ•°æ®ã€‚

æ•´ä¸ªè¿‡ç¨‹å¯å¦‚ä¸‹å›¾æ‰€ç¤º

![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-search.png/zipstyle)

ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äº**éèšç°‡ç´¢å¼•ä¼šå¤šä¸€æ¬¡æŸ¥è¯¢èšç°‡ç´¢å¼•çš„è¿‡ç¨‹**

## ç´¢å¼•ä¼˜åŒ–
### å›è¡¨

**å›è¡¨æ˜¯ä»€ä¹ˆ**ï¼Ÿ

å‡è®¾æœ‰å¦‚ä¸‹Sqlæ‰§è¡Œ

```sql
select * from student where name = 'å¼ ä¸‰';
```

ç”±äºæŸ¥è¯¢é”®ä¸ºnameï¼Œæ‰€ä»¥æŸ¥è¯¢æ—¶èµ°è¾…åŠ©ç´¢å¼•æ ‘ï¼Œå¾ˆå¿«å°±å®šä½åˆ°äº†`Name=å¼ ä¸‰`çš„å¶å­èŠ‚ç‚¹ï¼Œä½†ç”±äºæŸ¥è¯¢æ¡ä»¶ä¸º`select *`ï¼Œè¾…åŠ©ç´¢å¼•æ ‘ä¸­å¹¶æ²¡æœ‰åŒ…å«å…¨è¡¨å­—æ®µï¼Œæ‰€ä»¥ä¼šå†æ¬¡æ ¹æ®`Name=å¼ ä¸‰`çš„ä¸»é”®IdæŸ¥è¯¢ä¸»é”®ç´¢å¼•æ ‘ã€‚

è¿™ä¸ªè¿‡ç¨‹å’Œåˆšæ‰éèšç°‡ç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹ç›¸åŒï¼Œé€šè¿‡è¾…åŠ©ç´¢å¼•æŸ¥è¯¢åˆ°å­—æ®µï¼Œä½†ä»éœ€è¦èµ°ä¸»é”®ç´¢å¼•è¡¥å…¨selectä¿¡æ¯çš„è¿‡ç¨‹ï¼Œå«åš**å›è¡¨**ã€‚

### ç´¢å¼•è¦†ç›–

ç´¢å¼•è¦†ç›–å°±æ˜¯æ‰§è¡Œçš„sqlæŸ¥è¯¢çš„å­—æ®µåˆšå¥½å¯ä»¥å‘½ä¸­ç´¢å¼•ï¼Œä¸éœ€è¦é¢å¤–å›è¡¨

ä¾‹å¦‚

```sql
select id from student where id = 123
```

è¿™æ ·çš„æŸ¥è¯¢èƒ½å¤Ÿå‘½ä¸­ç´¢å¼•ï¼Œä¸”ç´¢å¼•å­—æ®µå’ŒæŸ¥è¯¢å­—æ®µåŒ¹é…

è€Œä¾‹å¦‚

```sql
select id, name from student where id = 123
```

è¿™æ ·çš„æŸ¥è¯¢åˆ™ä¼šå›è¡¨

### è”åˆç´¢å¼•

ä½œä¸ºä¸‹æ–‡çš„åŸºç¡€ï¼Œè¿™é‡Œå…ˆè¯´ä¸€ä¸‹è”åˆç´¢å¼•ã€‚

å‡è®¾ç°åœ¨æœ‰å¦‚ä¸‹åœºæ™¯ï¼ŒæŒ‰ç…§å¸‚æ°‘çš„èº«ä»½è¯å·å»æŸ¥è¯¢ä»–çš„å®¶åº­åœ°å€ï¼Œè¿™ä¸ªæŸ¥è¯¢éœ€æ±‚åœ¨ä¸šåŠ¡ä¸­å‡ºç°çš„æ¦‚ç‡ä¸é«˜ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¸èƒ½è®©ä»–ç›´æ¥èµ°å…¨è¡¨æ‰«æã€‚

å¦‚æœå•ç‹¬çš„ä¸ºä¸€ä¸ªä¸é¢‘ç¹çš„æŸ¥è¯¢è¯·æ±‚åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œæ„Ÿè§‰åˆæœ‰ç‚¹æµªè´¹èµ„æºï¼Œè¿™æ—¶å€™å°±å¯ä»¥é€šè¿‡å»ºç«‹è”åˆç´¢å¼•ï¼Œå‡å°‘å¼€é”€ã€‚

å‡è®¾ä»¥æ•°æ®åº“çš„`a`å­—æ®µå’Œ`b`å­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œ`a`å’Œ`b`å‡ä¸º`int`ç±»å‹å­—æ®µ

```sql
alter table 'table_name' add index index_name('a','b');
```

åˆ™ç”Ÿæˆçš„è”åˆç´¢å¼•B+æ ‘ä¼šä»¥è”åˆç´¢å¼•å­—æ®µå…±åŒå»ºç«‹ï¼Œå³è”åˆç´¢å¼•çš„é”®å€¼å¯¹å¤§äº1ä¸ª

::: center
![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-unindex.png/zipstyle)
:::

å°†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æŒ‰ç…§å­—æ®µæ‹¿å‡ºæ¥è¿›è¡Œåˆ†æï¼Œä»å·¦è‡³å³

açš„é¡ºåºä¸º: 1, 1, 2, 2, 3, 3

bçš„é¡ºåºä¸º: 1, 2, 1, 4, 1, 2

å¤§å®¶å¯ä»¥å‘ç°`a`å­—æ®µæ˜¯æœ‰åºæ’åˆ—ï¼Œ`b`å­—æ®µæ˜¯æ— åºæ’åˆ—(å› ä¸ºB+æ ‘åªèƒ½é€‰æ‹©ä¸€ä¸ªå­—æ®µæ¥æ„å»ºæœ‰åºçš„æ ‘)

åŒæ—¶é€šè¿‡è§‚å¯Ÿè¿˜å¯ä»¥å‘ç°ï¼Œ**åœ¨aç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œbå­—æ®µæ˜¯æœ‰åºçš„**ï¼Œå³æ­¤æ—¶`a=1`æ—¶ï¼Œ`b=1ï¼Œ2`ï¼Œbä¿æŒç›¸å¯¹æœ‰åºã€‚

åœ¨å¹³æ—¶çš„sqlä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæœ‰ä¸ªå…±è¯†ï¼Œå½“è¦å¯¹ä¸¤ä¸ªå­—æ®µè¿›è¡Œæ’åºæ—¶ï¼Œé¦–å…ˆä¼šæŒ‰ç…§ç¬¬ä¸€ä¸ªå­—æ®µæ’åºï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—æ®µç›¸ç­‰ï¼Œåˆ™ç”¨ç¬¬äºŒä¸ªå­—æ®µæ’åºã€‚

è¿™ç§å…±è¯†çš„åŸç†å°±æ˜¯å› ä¸ºï¼Œè”åˆå¤šå­—æ®µå»ºæ ‘æ—¶B+æ ‘çš„ç‹¬ç‰¹æ„å»ºæ–¹å¼ã€‚

### æœ€å·¦å‰ç¼€åŸåˆ™

æœ‰äº†è”åˆç´¢å¼•çš„æ¦‚å¿µï¼Œæœ€å·¦å‰ç¼€åŸåˆ™å°±å¥½ç†è§£äº†ï¼Œç”±äºB+æ ‘çš„å»ºæ ‘æ–¹å¼ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œä¸”å¶å­èŠ‚ç‚¹ä»å·¦å¾€å³æ’åºä¿æŒé¡ºåºï¼Œæ˜¯æœ€å·¦å‰ç¼€åŒ¹é…çš„æ ¹æœ¬åŸå› ã€‚

å¦‚æœè¦æŸ¥è¯¢`a`å­—æ®µæ‰€æœ‰ä»¥`1`å¼€å¤´çš„æ•°æ®ï¼Œåˆ™å¯¹åº”çš„`SQL`æ¡ä»¶ä¸º`where a like '1%'`ã€‚è¿™ä¸ªæ—¶å€™ç´¢å¼•èƒ½å¤Ÿç”¨ä¸Šï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„è®°å½•ä¸º`ID-1`,ç„¶åä¸€ç›´å‘åéå†ï¼Œç›´åˆ°ä¸æ»¡è¶³æ¡ä»¶ä¸ºæ­¢ã€‚

å†ä¸¾ä¸€ä¸ªèƒ½èµ°è”åˆç´¢å¼•çš„ä¾‹å­ï¼Œå¦‚`select * from student where a=1 and b=2`ã€‚

- é¦–å…ˆaå­—æ®µåœ¨B+æ ‘ä¸Šæ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ¥å®šä½åˆ°a=1çš„ä½ç½®ï¼Œå…¶æ¬¡åœ¨aç¡®å®šçš„æƒ…å†µä¸‹ï¼Œbæ˜¯ç›¸å¯¹æœ‰åºçš„ã€‚å› ä¸ºæœ‰åºï¼Œæ‰€ä»¥æˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°b=2çš„ä½ç½®ã€‚æ­¤æ—¶ç´¢å¼•æ˜¯æœ‰æ•ˆçš„ã€‚


å†ä¸¾ä¸€ä¸ªä¸èƒ½èµ°è”åˆç´¢å¼•çš„ä¾‹å­ï¼Œå¦‚`select * from student where b=2`ã€‚

- bå­—æ®µæœ‰åºçš„å‰ææ˜¯ï¼šåœ¨aç¡®å®šçš„æƒ…å†µä¸‹ï¼Œç°åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¹¶æ²¡æœ‰è§„å®šaçš„èŒƒå›´ï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•ç¡®å®šbçš„é¡ºåºï¼Œåœ¨ä¸€æ£µæ— åºçš„B+æ ‘ä¸Šæ˜¯æ— æ³•ç”¨äºŒåˆ†æŸ¥æ‰¾æ¥å®šä½åˆ°bå­—æ®µçš„ï¼Œè¿™ä¸ªæ—¶å€™ç´¢å¼•å¤±æ•ˆã€‚


### ç´¢å¼•ä¸‹æ¨

æœ€å·¦å‰ç¼€å¯ä»¥ç”¨åœ¨ç´¢å¼•ä¸­å®šä½è®°å½•ï¼Œé‚£ä¹ˆé‚£äº›ä¸ç¬¦åˆæœ€å·¦å‰ç¼€çš„éƒ¨åˆ†ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ

è¿˜æ˜¯ä»¥è”åˆç´¢å¼•(a, b)ä¸ºä¾‹ï¼Œå‡è®¾ç°åœ¨è¡¨å†…æœ‰`a,b,c,d...`å¤šä¸ªå­—æ®µï¼Œå¦‚æœç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼šæ£€ç´¢å‡ºè¡¨ä¸­aå­—æ®µç¬¬ä¸€ä¸ªæ•°å­—ä¸º1ï¼Œä¸”bå­—æ®µä¸º2ï¼Œcå­—æ®µä¸º3çš„æ‰€æœ‰æ•°æ®ã€‚é‚£ä¹ˆè¿™æ¡Sqlè¯­å¥åˆ™æ˜¯è¿™ä¹ˆå†™çš„ï¼š

```sql
select * from student where a like '1%' and b=2 and c=3;
```

æ ¹æ®å‰ç¼€è§„åˆ™ï¼Œè¿™ä¸ªè¯­å¥åœ¨æœç´¢ç´¢å¼•æ ‘æ—¶ï¼Œåªèƒ½ç”¨`1`ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•`ID-1`ã€‚

ä¹‹ååˆ™éœ€è¦åˆ¤æ–­å…¶ä»–æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚åœ¨MySQL5.6ä¹‹å‰ï¼Œåªèƒ½ä»ID1å¼€å§‹ä¸€ä¸ªä¸ªå›è¡¨ã€‚åˆ°ä¸»é”®ç´¢å¼•ä¸Šæ‰¾å‡ºæ•°æ®è¡Œï¼Œå†å¯¹æ¯”å­—æ®µå€¼ã€‚

è€ŒMySQL5.6å¼•å…¥çš„ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–(index condition pushdown)ï¼Œå¯ä»¥åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚

è¿™ä¸¤ä¸ªè¿‡ç¨‹å¯å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

æ— ç´¢å¼•ä¸‹æ¨è¿‡ç¨‹ï¼Œå‡éœ€è¦å›è¡¨

::: center
![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-nounder.png/zipstyle)
:::

ç´¢å¼•ä¸‹æ¨è¿‡ç¨‹

::: center
![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-under.png/zipstyle)
:::

åœ¨è¿™ä¸¤ä¸ªå›¾ä¸­ï¼Œæ¯ä¸ªç®­å¤´è¡¨ç¤ºå›è¡¨ä¸€æ¬¡

åœ¨æ— ç´¢å¼•ä¸‹æ¨è¿‡ç¨‹ä¸­ï¼ŒInnoDBåªéœ€è¦è§‚å¯Ÿ`a`å­—æ®µçš„å€¼ï¼ŒæŒ‰é¡ºåºæŠŠ`a`å­—æ®µç¬¬ä¸€ä¸ªæ•°å€¼ä¸º`1`çš„è®°å½•ä¸€æ¡æ¡å–å‡ºæ¥è¿›è¡Œå›è¡¨ï¼Œæ‰€ä»¥æ€»è®¡éœ€è¦å›è¡¨2æ¬¡ã€‚

ç´¢å¼•ä¸‹æ¨è¿‡ç¨‹çš„åŒºåˆ«åœ¨äºï¼ŒInnoDBåœ¨(a, b)ç´¢å¼•å†…éƒ¨å°±åˆ¤æ–­äº†`b`å­—æ®µæ˜¯å¦ç­‰äº2ï¼Œå¯¹äºä¸ç­‰äº2çš„è®°å½•ï¼Œç›´æ¥åˆ¤æ–­å¹¶è·³è¿‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªéœ€è¦å¯¹ID-2è¿™ä¸€æ¡è®°å½•å›è¡¨å–æ•°æ®åˆ¤æ–­ï¼Œåªéœ€è¦å›è¡¨1æ¬¡ã€‚

### ç´¢å¼•åˆ†æâ€”æ‰§è¡Œè®¡åˆ’

è¯´äº†è¿™ä¹ˆå¤šï¼Œå¯¹äºä¸€æ¡SQLï¼Œæˆ‘ä»¬åˆ†æçš„æ€è·¯åº”è¯¥æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

MySQLæä¾›äº†`explain`å‘½ä»¤ï¼Œå¯ä»¥ç”¨äºå¯¹SQLçš„åˆ†æï¼Œæ ¹æ®åˆ†æå‡ºçš„ç»“æœï¼Œå¼€å‘è€…å¯ä»¥é’ˆå¯¹æ€§çš„è¿›è¡Œä¼˜åŒ–

::: tip
åç»­æ“ä½œåŸºäºå¦‚ä¸‹æ•°æ®è¡¨
:::

```sql
create table if not exists testIndex.t_users
(
	id bigint auto_increment comment 'è‡ªå¢ID'
		primary key,
	name varchar(50) not null comment 'å§“å',
	sex int not null comment 'æ€§åˆ«ï¼Œ0å¥³ï¼Œ1ç”·',
	age int not null comment 'å¹´é¾„',
	info json null comment 'ä¿¡æ¯'
);

INSERT INTO testIndex.t_users (id, name, sex, age, info) VALUES (1, 'å¼ ä¸‰', 1, 15, '{"text": "æˆ‘æ˜¯å¼ ä¸‰"}');
INSERT INTO testIndex.t_users (id, name, sex, age, info) VALUES (2, 'æå››', 1, 16, '{"text": "æˆ‘æ˜¯æå››"}');
INSERT INTO testIndex.t_users (id, name, sex, age, info) VALUES (3, 'ç‹äº”', 0, 12, '{"text": "æˆ‘æ˜¯ç‹äº”"}');
```

**å¦‚ä½•ä½¿ç”¨**ï¼Ÿ

åœ¨éœ€è¦æ‰§è¡Œçš„SQLå‰åŠ ä¸Š`explain`å‘½ä»¤æ‰§è¡Œå³å¯ï¼Œå¦‚ï¼š

```sql
mysql> explain select * from t_users where id < 2 \G;
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t_users
   partitions: NULL
         type: range
possible_keys: PRIMARY
          key: PRIMARY
      key_len: 8
          ref: NULL
         rows: 1
     filtered: 100.00
        Extra: Using where
1 row in set, 1 warning (0.00 sec)
```

åœ¨explainè¾“å‡ºçš„å†…å®¹ä¸­ï¼Œé‡ç‚¹å…³æ³¨`select_type`ï¼Œ`type`ï¼Œ`key`ï¼Œ`rows`ï¼Œ`Extra`

1. select_type: è¡¨ç¤ºæŸ¥è¯¢ç±»å‹, å¸¸è§å€¼è¡¨æ ¼å¦‚ä¸‹

::: center
| æŸ¥è¯¢ç±»å‹  | è§£é‡Š |
| ------- | --------------------------------- |
| SIMPLE | è¡¨ç¤ºæŸ¥è¯¢è¯­å¥ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…union |
| PRIMARY | è¡¨ç¤ºæ­¤æŸ¥è¯¢æœ€å¤–å±‚çš„æŸ¥è¯¢ |
| UNION | è¡¨ç¤ºæ­¤æŸ¥è¯¢æ˜¯unionçš„ç¬¬äºŒä¸ªæˆ–è€…åç»­çš„æŸ¥è¯¢ |
| DEPENDENT UNION | unionä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åç»­çš„æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†å¤–é¢çš„æŸ¥è¯¢ç»“æœ |
| UNION RESULR | unionçš„ç»“æœ |
| SUNQUERY | selectå­æŸ¥è¯¢è¯­å¥ |
| DEPENDENT SUBQUERY | selectå­æŸ¥è¯¢è¯­å¥ä¾èµ–å¤–å±‚çš„æŸ¥è¯¢ç»“æœ |
:::

2. type: è¡¨ç¤ºå­˜å‚¨å¼•æ“æŸ¥è¯¢æ•°æ®æ—¶é‡‡ç”¨çš„æ–¹å¼ã€‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å±æ€§ï¼Œé€šè¿‡å®ƒå¯ä»¥åˆ¤æ–­å‡ºæŸ¥è¯¢æ˜¯å…¨è¡¨æ‰«æè¿˜æ˜¯åŸºäºç´¢å¼•çš„éƒ¨åˆ†æ‰«æã€‚

   å®ƒçš„å¸¸è§å±æ€§å¦‚ä¸‹(ä»ä¸Šåˆ°ä¸‹ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¾æ¬¡å¢å¼º)

- ALL: å…¨è¡¨æ‰«æ

```sql
mysql> explain select * from t_users \G;
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t_users
   partitions: NULL
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: 3
     filtered: 100.00
        Extra: NULL
1 row in set, 1 warning (0.00 sec)
```

- index: åŸºäºç´¢å¼•çš„å…¨è¡¨æ‰«æï¼Œå…ˆæ‰«æç´¢å¼•å†æ‰«æå…¨è¡¨(åœ¨æ’åºä¸Šæ€§èƒ½ä¼˜äºALL)

```sql
mysql> explain select id from t_users \G;
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t_users
   partitions: NULL
         type: index
possible_keys: NULL
          key: PRIMARY
      key_len: 8
          ref: NULL
         rows: 3
     filtered: 100.00
        Extra: Using index
1 row in set, 1 warning (0.00 sec)
```

- range: è¡¨ç¤ºä½¿ç”¨ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢ã€‚ç”¨>,>=,<,<=ç­‰

```sql
mysql> explain select * from t_users where id > 0 \G;
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t_users
   partitions: NULL
         type: range
possible_keys: PRIMARY
          key: PRIMARY
      key_len: 8
          ref: NULL
         rows: 3
     filtered: 100.00
        Extra: Using where
1 row in set, 1 warning (0.00 sec)
```

- ref: è¡¨ç¤ºä½¿ç”¨éå”¯ä¸€ç´¢å¼•è¿›è¡Œå•å€¼æŸ¥è¯¢

å…ˆä¸ºageå­—æ®µåˆ›å»ºç´¢å¼•

```sql
mysql> alter table t_users add index `idx_t_user_age` (`age`);
Query OK, 0 rows affected (0.21 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> explain select * from t_users where age = 15 \G;
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t_users
   partitions: NULL
         type: ref
possible_keys: idx_t_user_age
          key: idx_t_user_age
      key_len: 4
          ref: const
         rows: 1
     filtered: 100.00
        Extra: NULL
1 row in set, 1 warning (0.00 sec)
```

- eq_ref: ä¸€èˆ¬æƒ…å†µä¸‹å‡ºç°åœ¨å¤šè¡¨joinæŸ¥è¯¢ï¼Œè¡¨ç¤ºå‰é¢è¡¨çš„æ¯ä¸€è¡Œè®°å½•ï¼Œéƒ½åªèƒ½åŒ¹é…åé¢è¡¨çš„ä¸€è¡Œç»“æœ

åˆ›å»ºæˆç»©è¡¨t_exam

```sql
create table if not exists testIndex.t_exam
(
	id bigint auto_increment comment 'è‡ªå¢ID'
		primary key,
	user_id bigint not null comment 'ç”¨æˆ·ID',
	score int null comment 'æˆç»©'
);

INSERT INTO testIndex.t_exam (id, user_id, score) VALUES (1, 1, 96);
INSERT INTO testIndex.t_exam (id, user_id, score) VALUES (2, 2, 86);
INSERT INTO testIndex.t_exam (id, user_id, score) VALUES (3, 3, 76);
```

é‡‡ç”¨å¤šè¡¨joinæŸ¥è¯¢

```sql
mysql> explain select * from t_users tu left join t_exam te on tu.id = te.user_id where te.score = 96;
+----+-------------+-------+------------+--------+---------------+---------+---------+----------------------+------+----------+-------------+
| id | select_type | table | partitions | type   | possible_keys | key     | key_len | ref                  | rows | filtered | Extra       |
+----+-------------+-------+------------+--------+---------------+---------+---------+----------------------+------+----------+-------------+
|  1 | SIMPLE      | te    | NULL       | ALL    | NULL          | NULL    | NULL    | NULL                 |    3 |    33.33 | Using where |
|  1 | SIMPLE      | tu    | NULL       | eq_ref | PRIMARY       | PRIMARY | 8       | testIndex.te.user_id |    1 |   100.00 | NULL        |
+----+-------------+-------+------------+--------+---------------+---------+---------+----------------------+------+----------+-------------+
2 rows in set, 1 warning (0.00 sec)
```

- const: è¡¨ç¤ºä½¿ç”¨ä¸»é”®æˆ–è€…å«è¡£ç´¢å¼•åšç­‰å€¼æŸ¥è¯¢

```sql
mysql> explain select * from t_users where id = 1 \G;
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t_users
   partitions: NULL
         type: const
possible_keys: PRIMARY
          key: PRIMARY
      key_len: 8
          ref: const
         rows: 1
     filtered: 100.00
        Extra: NULL
1 row in set, 1 warning (0.00 sec)
```

- null: è¡¨ç¤ºä¸ç”¨è®¿é—®è¡¨ï¼Œé€Ÿåº¦æœ€å¿«

```sql
mysql> explain select 1;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | No tables used |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
1 row in set, 1 warning (0.00 sec)

mysql> explain select now();
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | No tables used |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
1 row in set, 1 warning (0.00 sec)
```

3. possible_keys: è¡¨ç¤ºæŸ¥è¯¢æ—¶èƒ½å¤Ÿä½¿ç”¨åˆ°çš„ç´¢å¼•ï¼Œå¹¶ä¸ä¸€å®šä¼šçœŸçš„ä½¿ç”¨ï¼Œæ˜¾ç¤ºçš„æ˜¯ç´¢å¼•åç§°

4. key: è¡¨ç¤ºæŸ¥è¯¢æ—¶çœŸæ­£ç”¨åˆ°çš„ç´¢å¼•ï¼Œæ˜¾ç¤ºçš„æ˜¯ç´¢å¼•åç§°

5. rows: MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨æ ¹æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œä¼°ç®—è¦æŸ¥è¯¢åˆ°ç»“æœéœ€è¦æ‰«æå¤šå°‘è¡Œè®°å½•ã€‚åŸåˆ™ä¸Šrowsè¶Šå°‘æ•ˆç‡è¶Šé«˜ã€‚

6. key_len: è¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•çš„å­—èŠ‚æ•°é‡ã€‚å¯ä»¥åˆ¤æ–­æ˜¯å¦å…¨éƒ¨ä½¿ç”¨äº†è”åˆç´¢å¼•ã€‚

7. extra: è¡¨ç¤ºé¢å¤–ä¿¡æ¯ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹è¡¨ç°

- using where: è¡¨ç¤ºæŸ¥è¯¢éœ€è¦é€šè¿‡ç´¢å¼•å›è¡¨æŸ¥è¯¢æ•°æ®ã€‚å³é€šè¿‡æ™®é€šç´¢å¼•æŸ¥è¯¢å‡ºä¸»é”®ï¼Œå†é€šè¿‡ä¸»é”®æŸ¥è¯¢å‡ºæ•°æ®ã€‚

```sql
mysql> explain select age from t_users where age = 15 and name = 'å¼ ä¸‰';
+----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+
| id | select_type | table   | partitions | type | possible_keys  | key            | key_len | ref   | rows | filtered | Extra       |
+----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+
|  1 | SIMPLE      | t_users | NULL       | ref  | idx_t_user_age | idx_t_user_age | 4       | const |    1 |    33.33 | Using where |
+----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)
```

- using index: è¡¨ç¤ºé€šè¿‡ç´¢å¼•å°±èƒ½æŸ¥è¯¢å‡ºæ‰€éœ€è¦çš„æ•°æ®ã€‚**æ•ˆç‡æœ€é«˜**

```sql
mysql> explain select age from t_users where age=1;
+----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+
| id | select_type | table   | partitions | type | possible_keys  | key            | key_len | ref   | rows | filtered | Extra       |
+----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+
|  1 | SIMPLE      | t_users | NULL       | ref  | idx_t_user_age | idx_t_user_age | 4       | const |    1 |   100.00 | Using index |
+----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)
```

- using filesort: è¡¨ç¤ºæŸ¥è¯¢ç»“æœéœ€è¦é¢å¤–æ’åºï¼Œæ•°æ®é‡å°åœ¨å†…å­˜ï¼Œæ•°æ®é‡å¤§åœ¨ç£ç›˜ã€‚å¦‚æœå‡ºç°è¿™ä¸ªå­—æ®µï¼Œå»ºè®®ä¼˜åŒ–SQL

```sql
mysql> explain select * from t_users order by id;
+----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------+
| id | select_type | table   | partitions | type  | possible_keys | key     | key_len | ref  | rows | filtered | Extra |
+----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------+
|  1 | SIMPLE      | t_users | NULL       | index | NULL          | PRIMARY | 8       | NULL |    3 |   100.00 | NULL  |
+----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------+
1 row in set, 1 warning (0.00 sec)

mysql> explain select * from t_users order by id,age;
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+----------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+----------------+
|  1 | SIMPLE      | t_users | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    3 |   100.00 | Using filesort |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+----------------+
1 row in set, 1 warning (0.00 sec)
```

- using temproary: è¡¨ç¤ºæŸ¥è¯¢ç”¨åˆ°äº†ä¸´æ—¶è¡¨ï¼Œä¸€èˆ¬å‡ºç°åœ¨å»é‡ã€åˆ†ç»„ç­‰æ“ä½œ

```sql
mysql> explain select distinct name from t_users;
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra           |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------+
|  1 | SIMPLE      | t_users | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    3 |   100.00 | Using temporary |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------+
1 row in set, 1 warning (0.00 sec)

mysql> explain select name, count(*) name from t_users group by name;
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------+
| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra           |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------+
|  1 | SIMPLE      | t_users | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    3 |   100.00 | Using temporary |
+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------+
1 row in set, 2 warnings (0.00 sec)
```

### ç´¢å¼•å¤±æ•ˆåœºæ™¯

#### ä½¿ç”¨åŸåˆ™

1. ä½¿ç”¨è”åˆç´¢å¼•åº”æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™

2. åŒ¹é…æ•°æ®ä»å·¦è‡³å³ï¼Œé‡åˆ°èŒƒå›´æŸ¥è¯¢(>ã€<ã€betweenã€like)ä¼šåœæ­¢åŒ¹é…

3. å°½é‡é€‰æ‹©é«˜åŒºåˆ†åº¦çš„å­—æ®µä½œä¸ºç´¢å¼•

åŒºåˆ†åº¦å…¬å¼ï¼š`count(distinct col) / count(*)`ï¼Œè¡¨ç¤ºå­—æ®µä¸é‡å¤çš„æ¯”ä¾‹ï¼Œæ¯”ä¾‹è¶Šå¤§æ‰«æçš„è®°å½•æ•°è¶Šå°‘ã€‚

4. ç´¢å¼•å°½é‡ä¸ç”¨åœ¨é«˜é¢‘æ›´æ–°çš„å­—æ®µä¸Šï¼Œæœ€å¥½ç”¨åœ¨é«˜é¢‘æŸ¥è¯¢å­—æ®µ

#### å¤±æ•ˆåœºæ™¯

1. like '%xx'

```sql
select * from t_users where name like '%å¼ ';
```

é¦–å­—æ¯æœ‰åºæ—¶ï¼Œåç»­ç›¸å¯¹æœ‰åºï¼Œä½†æ— æ³•ç¡®å®šé¦–å­—ç¬¦æ—¶ï¼ŒæŸ¥è¯¢æ˜¯ä¹±åºçš„ã€‚

2. ä½¿ç”¨å‡½æ•°

æ¯”å¦‚å°†ç´¢å¼•åˆ—æ”¾å…¥å‡½æ•°è®¡ç®—ä¸­ï¼Œå°±æ— æ³•èµ°ç´¢å¼•ï¼Œæ¯”å¦‚`max(age)`ã€‚å…¶åŸå› åœ¨äºï¼ŒB+æ ‘éœ€è¦æŠŠæ‰€æœ‰å…ƒç´ éƒ½åº”ç”¨åœ¨å‡½æ•°ä¸­æ‰èƒ½æ¯”è¾ƒã€‚

3. or

æ¯”å¦‚`a,b,c`ä¸‰ä¸ªå­—æ®µï¼Œ`a`å’Œ`b`å»ºäº†ç´¢å¼•ï¼Œ`c`æ²¡æœ‰å»ºç´¢å¼•

å½“æ‰§è¡Œå¦‚ä¸‹SQLæ—¶ï¼Œèƒ½ä½¿ç”¨ç´¢å¼•

```sql
select * from test where a = 1 or b = 2;
```

å½“æ‰§è¡Œå¦‚ä¸‹SQLæ—¶ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œaå’Œbçš„ç´¢å¼•å¤±æ•ˆ

```sql
select * from test where a = 1 or b = 2 or c = 3;
```

4. ä½¿ç”¨select *

select *ä¼šé‡‡ç”¨å…¨è¡¨æ‰«æï¼Œå³ä½¿å»ºç«‹äº†ç´¢å¼•ï¼Œç´¢å¼•ä¹Ÿä¼šè¿›è¡Œå›è¡¨ï¼Œæ•ˆç‡ä½ä¸‹

5. å­—æ®µç±»å‹ä¸åŒ

æ¯”å¦‚æœ‰ä¸ªå­—æ®µageï¼ŒåŸæœ¬æ˜¯varcharï¼Œä½†SQLæŸ¥è¯¢æ—¶ç”¨çš„intç±»å‹ä¼ å‚ï¼Œè™½ç„¶æŸ¥è¯¢èƒ½å¤ŸæˆåŠŸï¼Œä½†å®é™…ä¸Šèµ°çš„å…¨è¡¨æ‰«æï¼ŒMySQLé€šè¿‡å­—æ®µçš„éšå¼è½¬æ¢ä¿è¯äº†SQLæ‰§è¡ŒæˆåŠŸ

```sql
select * from test where age = 123;
```

6. ä¸ç­‰äº

æ™®é€šç´¢å¼•çš„ä¸ç­‰äºä¸ä¼šèµ°ç´¢å¼•

```sql
select * from test where name !='å¼ ä¸‰';
```

ä¸»é”®ç´¢å¼•çš„ä¸ç­‰äºä¼šèµ°ç´¢å¼•

```sql
select * from test where id ! = 123;
```

7. order by

order byæ’åºæ¡ä»¶ä¸ºç´¢å¼•ï¼Œåˆ™selectå­—æ®µå¿…é¡»ä¹Ÿæ˜¯ç´¢å¼•å­—æ®µï¼Œå¦åˆ™æ— æ³•å‘½ä¸­ç´¢å¼•

å¦‚æœå¯¹ä¸»é”®æ’åºï¼Œåˆ™è¿˜æ˜¯èƒ½å¤Ÿèµ°ç´¢å¼•

```sql
select * from test order by id desc;
```

8. èŒƒå›´æŸ¥è¯¢

æ¯”å¦‚`a,b,c`ä¸‰ä¸ªå­—æ®µï¼Œ`a`ã€`b`ã€`c`éƒ½å»ºäº†ç´¢å¼•

```sql
select * from test where a = 1 and b > 2 and c = 3
```

åªæœ‰aå’Œbèƒ½å¤Ÿèµ°ç´¢å¼•ï¼Œcä¸èƒ½èµ°ç´¢å¼•ï¼ŒèŒƒå›´æŸ¥è¯¢å°±æ˜¯ç´¢å¼•æˆªæ–­å¤„ï¼ŒåŸå› å’Œè”åˆç´¢å¼•ä¸€è‡´ï¼Œåœ¨æ— æ³•ç¡®å®šbæœ‰å¤šå°‘æ•°é‡æ—¶ï¼Œæ— æ³•ä¿è¯bçš„é¡ºåºæ€§ï¼Œåœ¨è¿™ä¸ªå‰æä¸‹å¯¼è‡´cæ— æ³•ç¡®å®š

### å°è¡¨é©±åŠ¨å¤§è¡¨

è¿™é‡Œè¡¥å……ä¸€ä¸ªé¢å¤–çš„çŸ¥è¯†ï¼Œå°è¡¨é©±åŠ¨å¤§è¡¨ã€‚

é¦–å…ˆå¼•å…¥ä¸€å¼ ç½‘ç»œä¸­æµä¼ çš„ç»å…¸å›¾ï¼Œäº†è§£`left join`, `inner join`, `right join`ç­‰å¸¸è§ç»“æœ

::: center
![](https://image-1-1257237419.cos.ap-chongqing.myqcloud.com/img/mysql-join.png/zipstyle)
:::

æ‰€è°“çš„å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Œå¯ä»¥ç†è§£ä¸ºç”¨å°çš„æ•°æ®é›†å»åŒ¹é…å¤§çš„æ•°æ®é›†ã€‚

æ¯”å¦‚è¡¨Aä¸­æœ‰10æ¡æ•°æ®ï¼Œè¡¨Bä¸­æœ‰10wæ¡æ•°æ®ï¼Œå¤–éƒ¨æ‰§è¡Œä¸€æ¬¡è¿æ¥ï¼Œå†…éƒ¨è¦æ‰§è¡Œå¤šæ¬¡

æŒ‰ç…§å°è¡¨é©±åŠ¨å¤§è¡¨ï¼ŒAé©±åŠ¨Bï¼Œåˆ™ä¼ªä»£ç å¯å†™ä¸º

```java
for (10æ¡) {
    for (10wæ¡) {
        ...
    }
}
```

å¤§è¡¨é©±åŠ¨å°è¡¨ï¼Œå³Bé©±åŠ¨Aï¼Œä¼ªä»£ç å¯å†™ä¸º

```java
for (10wæ¡) {
    for (10æ¡) {
        ...
    }
}
```

ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼šå°çš„å¾ªç¯åœ¨å¤–å±‚ï¼Œè¡¨è¿æ¥éœ€è¦10æ¬¡ï¼›å¤§çš„å¾ªç¯åœ¨å¤–å±‚ï¼Œè¡¨è¿æ¥éœ€è¦10wæ¬¡ã€‚

**å°è¡¨é©±åŠ¨å¤§è¡¨çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘è¿æ¥åˆ›å»ºçš„æ¬¡æ•°ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦**ã€‚

å¦‚ä½•åˆ¤æ–­é©±åŠ¨è¡¨å’Œéé©±åŠ¨è¡¨ï¼Ÿ

1 LEFT JOINå·¦è¿æ¥, å·¦è¾¹ä¸ºé©±åŠ¨è¡¨, å³è¾¹ä¸ºè¢«é©±åŠ¨è¡¨

2 RIGHT JOINå³è¿æ¥, å³è¾¹ä¸ºé©±åŠ¨è¡¨, å·¦è¾¹ä¸ºè¢«é©±åŠ¨è¡¨

3 INNER JOINå†…è¿æ¥, MySQLä¼šé€‰æ‹©æ•°æ®é‡æ¯”è¾ƒå°çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨

4 å¯é€šè¿‡EXPLANINæŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’, EXPLANINåˆ†æçš„ç¬¬ä¸€è¡Œçš„è¡¨å³æ˜¯é©±åŠ¨è¡¨

## æ€»ç»“
ç›¸ä¿¡è¯»å®Œè¿™ç¯‡æ–‡ç« ï¼Œè¯»è€…èƒ½å¤Ÿå¯¹ç´¢å¼•å’ŒB+æ ‘çš„åŸç†æœ‰ä¸€å®šçš„äº†è§£ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­è§£å†³æ…¢SQLæœ€ä¸ºåŸºæœ¬çš„åˆ†ææ–¹å¼å¯ä»¥é‡‡ç”¨explainï¼ŒåŠ ä¸Šç´¢å¼•èƒ½å¤Ÿæœ€ç®€å•æœ‰æ•ˆçš„åŠ å¿«æŸ¥è¯¢æ•ˆç‡

é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ä»ç½‘ç»œã€MySQLæ¶æ„(è¯»å†™åˆ†ç¦»/å†·çƒ­å¤‡)ç­‰æ–¹å‘è¿›è¡Œè€ƒè™‘ï¼Œç”±äºç¯‡å¹…åŸå› è¿™é‡Œæš‚ä¸ä»‹ç»äº†~

## å‚è€ƒæ–‡ç« 

> ã€ŠMySQL45è®²ã€‹
>
> <https://www.cnblogs.com/aaabbbcccddd/p/14864982.html>
>
> <https://www.jb51.net/article/229580.htm>
>
> <https://mp.weixin.qq.com/s/SSHWKcuGK5x4Uf7ZBC7stQ>
>
> <https://blog.csdn.net/q736317048/article/details/114415571>
>
> <https://www.cnblogs.com/heishuichenzhou/p/10813463.html>
>
> <https://mp.weixin.qq.com/s/tD_yDXBYfmLqN3BHmhOnfQ>
>
> <https://blog.csdn.net/ABestRookie/article/details/117059948>


